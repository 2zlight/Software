version: 2
jobs:

    #    image: circleci/python:2.7.13
    #    image: circleci/classic:latest
    build:
     #docker:
     #   - image: ros/kinetic-ros-core-xenial
     machine: true
     steps:
        - checkout
        - run: echo "hello world"
        - run: echo `uname -a`
        - run: cat /etc/issue
        - run:
              name: install Indigo (compatible with 14.04)
              command: |
                sudo apt-get install lsb-release
                sudo sh -c 'echo "deb http://packages.ros.org/ros/ubuntu $(lsb_release -sc) main" > /etc/apt/sources.list.d/ros-latest.list'
                sudo apt-key adv --keyserver hkp://ha.pool.sks-keyservers.net:80 --recv-key 421C365BD9FF1F717815A3895523BAEEB01FA116
                sudo apt-get update
                sudo apt-get install ros-indigo-desktop
        - run:
            name: build
            command: |
                source /opt/ros/kinetic/setup.bash
                make build

        - run:
            name: run tests
            command: |
                source /opt/ros/kinetic/setup.bash
                make comptests

        - store_artifacts:
              path: test-reports
              destination: test-reports
