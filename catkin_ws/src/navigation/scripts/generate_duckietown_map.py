import pickle
from graph import Graph

class graph_creator():
    def __init__(self):
        self.node_locations = {}
        self.edges = []
    def add_node_locations(self,node_loc):
        self.node_locations = node_loc
    def add_edges(self, ed):
    	for edge in ed:
    		source = edge[0]
    		target = edge[1]
    		action = edge[2]
	        manhattan_dist = abs(self.node_locations[source][0] - self.node_locations[target][0]) + abs(self.node_locations[source][1] - self.node_locations[target][1])
	        self.edges.append([source, target, manhattan_dist, action])
    def save(self, name='duckietown_map.pkl'):
        afile = open(r'maps/duckietown_map.pkl', 'w+')
        pickle.dump([self.edges, self.node_locations], afile)
        afile.close()
    def draw(self):
        # Create graph
        duckietown_graph = Graph()
        for edge in self.edges:
	        duckietown_graph.add_edge(edge[0], edge[1], edge[2], edge[3])
	
        duckietown_graph.set_node_positions(self.node_locations)
        duckietown_graph.draw(map_name='duckietown_map')

if __name__ == "__main__":
    gc = graph_creator()

    # Node locations (for visual representation) and heuristics calculation
    node_locations = {"11":(4,0.75),"12":(3.75,1),"13":(3.25,1),"14":(3,0.75),"15":(3,0.25),"18":(4,0.25),
                      "21":(1,2.75),"22":(0.75,3),"23":(0.25,3),"26":(0.25,2),"27":(0.75,2),"28":(1,2.25),
                      "31":(1,5.75),"32":(0.75,6),"33":(0.25,6),"36":(0.25,5),"37":(0.75,5),"38":(1,5.25),
                      "41":(3,5.75),"42":(2.75,6),"43":(2.25,6),"44":(2,5.75),"45":(2,5.25),"46":(2.25,5),
                      "47":(2.75,5),"48":(3,5.25),
                      "51":(4,9.75),"54":(3,9.75),"55":(3,9.25),"56":(3.25,9),"57":(3.75,9),"58":(4,9.25),
                      "121":(3.75,3.25),"122":(5.25,3.25),"123":(5.25,0.75),
                      "181":(5.75,0.25),"182":(5.75,3.75),"183":(3.25,3.75),
                      "141":(0.75,0.75),
                      "261":(0.25,0.25),
                      "281":(2.75,2.25),
                      "481":(4.75,5.25),"482":(4.75,8.25),"483":(5.75,8.25),"484":(5.75,9.75),
                      "581":(5.25,9.25),"582":(5.25,8.75),"583":(4.25,8.75),"584":(4.25,5.75),
                      "561":(3.25,7.75),"562":(2.25,7.75),
                      "421":(2.75,7.25),"422":(3.75,7.25),
                      "541":(0.25,9.75),
                      "321":(0.75,9.25),
                      "461":(2.25,2.75)}

    # Create edges for the map.
    # Edges is a list of lists, in which each edge is in the format: [source, target, action]
    edges = [["11", "12", 'r'],
    ["11", "14",  's'],
    ["12", "121", 'f'], ["121", "122", 'f'], ["122", "123", 'f'], ["123", "11", 'f'] , 
    ["13", "14",  'r'],
    ["13", "18",  'l'],
    ["14", "141", 'f'], ["141", "27",  'f'],
    ["15", "12",  'l'],
    ["15", "18",  's'],
    ["18", "181", 'f'], ["181", "182", 'f'],  ["182", "183", 'f'],  ["183", "13", 'f'],

    ["21", "22",  'r'],
    ["21", "26",  'l'],
    ["22", "37",  'f'],
    ["23", "26",  's'],
    ["23", "28",  'r'],
    ["26", "261", 'f'], ["261", "15", 'f'],
    ["27", "22",  's'],
    ["27", "28",  'r'],
    ["28", "281",  'f'], ["281", "47",  'f'],

    ["31", "32",  'r'],
    ["31", "36",  'l'],
    ["32", "321",  'f'], ["321", "55",  'f'],
    ["33", "36",  's'],
    ["33", "38",  'r'],
    ["36", "23",  'f'],
    ["37", "32",  's'],
    ["37", "38",  'r'],
    ["38", "45",  'f'],
 
    ["41", "42",  'r'],
    ["41", "44",  's'],
    ["41", "46",  'l'],
    ["42", "421",  'f'], ["421", "422",  'f'], ["422", "57",  'f'],
    ["43", "44",  'r'],
    ["43", "46",  's'],
    ["43", "48",  'l'],
    ["44", "31",  'f'],
    ["45", "46",  'r'],
    ["45", "48",  's'],
    ["45", "42",  'l'],
    ["46", "461",  'f'], ["461", "21",  'f'],
    ["47", "48",  'r'],
    ["47", "42",  's'],
    ["47", "44",  'l'],
    ["48", "481",  'f'], ["481", "482",  'f'],["482", "483",  'f'],["483", "484",  'f'], ["484", "51",  'f'],
 
    ["51", "54",  's'],
    ["51", "56",  'l'],
    ["54", "541",  'f'], ["541", "33",  'f'],
    ["55", "56",  'r'],
    ["55", "58",  's'],
    ["56", "561",  'f'], ["561", "562",  'f'], ["562", "43",  'f'],
    ["57", "58",  'r'],
    ["57", "54",  'l'],
    ["58", "581",  'f'], ["581", "582",  'f'], ["582", "583",  'f'], ["583", "584",  'f'], ["584", "41",  'f']]
 
    gc.add_node_locations(node_locations)
    gc.add_edges(edges)
    gc.save()
    gc.draw()







