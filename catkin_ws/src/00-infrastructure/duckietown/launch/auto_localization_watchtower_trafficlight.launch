<launch>



  <arg name="veh"/>
  <arg name="local" default="false" doc="true for running everything you possibly can on laptop. false for everything running on vehicle."/>
  <arg name="config" default="baseline" doc="Specify a config."/>
  <arg name="param_file_name" default="default" doc="Specify a param file. ex:megaman." />
  <arg name="camera" default="true" doc="camera set to false means only apriltags no camera nodes are launched"/>
  <arg name="live" default="true" doc="live set to false means we don't run the actual camera (i.e. running from a log file" />
  <arg name="rect_full_ratio" default="true" doc="use full ration rectified image for apriltags detections " />

  <arg name="IP" default="0" doc="The IP address that the server laptop connected. The default was set in config file. See 00-infrastructure/duckietown/config/baseline/tcp_communication"/>

  <arg name="pkg_name" value="traffic_light"/>
  <arg name="param_tl_file_name" default="default" doc="Specify a param file. ex:megaman." />
  <arg name="node_name" default="traffic_light_node"/>
  <arg name="protocol_file" default="LED_protocol"/>
  <arg name="protocol_pkg_name" default="led_interpreter"/>

  <!-- Apriltags2 -->
  <include file="$(find duckietown)/launch/apriltags2.launch">
    <arg name="veh" value="$(arg veh)"/>
    <arg name="local" value="$(arg local)"/>
    <arg name="config" value="$(arg config)"/>
    <arg name="param_file_name" value="$(arg param_file_name)"/>
    <arg name="camera" value="$(arg camera)"/>
    <arg name="live" value="$(arg live)"/>
    <arg name="rect_full_ratio" value="$(arg rect_full_ratio)" />
  </include>

  <!-- Local Localization Postprocessing node -->
  <remap from="apriltags_in" to="tag_detections" />
  <include file="$(find auto_localization)/launch/apriltags2_local_localization_node.launch">
    <arg name="veh" value="$(arg veh)"/>
    <arg name="local" value="$(arg local)"/>
    <arg name="config" value="$(arg config)"/>
    <arg name="param_file_name" value="$(arg param_file_name)"/>
  </include>

  <!-- Set the process result to server-->
  <remap from="apriltags_out" to="apriltags2_local_localization_node/apriltags_out" />
  <include file="$(find auto_localization)/launch/pub2server.launch">
    <arg name="veh" value="$(arg veh)"/>
    <arg name="config" value="$(arg config)"/>
    <arg name="param_file_name" value="$(arg param_file_name)"/>
    <arg name="IP" value="$(arg IP)"/>
  </include>
  <!-- traffic_light -->

  <group ns="$(arg veh)">
    <!-- run local -->
    <node if="$(arg local)" name="$(arg node_name)" pkg="$(arg pkg_name)" type="$(arg node_name).py" output="screen">
      <rosparam command="load" file="$(find duckietown)/config/$(arg config)/$(arg pkg_name)/$(arg node_name)/$(arg param_file_name).yaml"/>
      <rosparam command="load" file="$(find duckietown)/config/$(arg config)/$(arg protocol_pkg_name)/$(arg protocol_file).yaml"/>
    </node>

    <!-- run remote -->
    <node unless="$(arg local)" machine="$(arg veh)" name="$(arg node_name)" pkg="$(arg pkg_name)" type="$(arg node_name).py" output="screen">
      <rosparam command="load" file="$(find duckietown)/config/$(arg config)/$(arg pkg_name)/$(arg node_name)/$(arg param_tl_file_name).yaml"/>
      <rosparam command="load" file="$(find duckietown)/config/$(arg config)/$(arg protocol_pkg_name)/$(arg protocol_file).yaml"/>
    </node>
  </group>

</launch>
